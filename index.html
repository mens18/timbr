<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timbratura</title>
    <script>
        function inviaDati() {
            let nome = document.getElementById("nome").value;
            let tipo = document.getElementById("tipo").value;
            let sede = document.getElementById("sede").value; // Nuovo campo sede
            let url = "https://script.google.com/macros/s/AKfycbz9qEykSeu0y_b_qiA2cnER98WpEIE7yjfqWT357M8Tbu6Z_CzcqOhNii4csfWoMSE/exec";

            if (!nome || !tipo || !sede) {
                alert("Compila tutti i campi!");
                return;
            }

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    let gps = position.coords.latitude + "," + position.coords.longitude;

                    fetch("https://api64.ipify.org?format=json")
                        .then(response => response.json())
                        .then(data => {
                            let ip = data.ip;

                            let requestUrl = `${url}?nome=${encodeURIComponent(nome)}&tipo=${encodeURIComponent(tipo)}&sede=${encodeURIComponent(sede)}&gps=${encodeURIComponent(gps)}&ip=${encodeURIComponent(ip)}`;

                            window.location.href = requestUrl;
                        })
                        .catch(error => alert("Errore nel recupero IP: " + error));
                },
                function(error) {
                    alert("Errore nel recupero della posizione: " + error.message);
                }
            );
        }
    </script>
</head>
<body>
    <h2>Registrazione Timbratura</h2>

    <label for="nome">Nome:</label>
    <select id="nome">
        <option value="Mario Rossi">Mario Rossi</option>
        <option value="Luigi Verdi">Luigi Verdi</option>
        <option value="Anna Bianchi">Anna Bianchi</option>
    </select><br><br>

    <label for="tipo">Tipo:</label>
    <select id="tipo">
        <option value="ingresso">Ingresso</option>
        <option value="uscita">Uscita</option>
    </select><br><br>

    <label for="sede">Sede:</label>
    <select id="sede">
        <option value="Sede Centrale">Sede Centrale</option>
        <option value="Filiale Nord">Filiale Nord</option>
        <option value="Filiale Sud">Filiale Sud</option>
    </select><br><br>

    <button onclick="inviaDati()">Invia</button>
</body>
</html>
